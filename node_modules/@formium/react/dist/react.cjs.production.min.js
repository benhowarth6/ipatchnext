"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@formium/types"),n=require("@formium/utils"),r=require("formik"),l=require("react"),i=(e=l)&&"object"==typeof e&&"default"in e?e.default:e,a=require("yup"),o=require("@formium/eval");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function m(e,t){if(null==e)return{};var n,r,l={},i=Object.keys(e);for(r=0;r<i.length;r++)t.indexOf(n=i[r])>=0||(l[n]=e[n]);return l}var c=n.canUseDOM()?l.useLayoutEffect:l.useEffect,s=function(e,n,l,i){return(l.type===t.FormElementType.RADIO||l.type===t.FormElementType.CHECKBOX||!!r.getIn(n,l.slug))&&o.evaluateLogic((a=e,function(e){return r.getIn(a,e)}),i);var a},d=l.memo((function(e){var n,i,a=e.form,o=e.element,u=e.setFieldProperty,m=r.useFormikContext(),c=m.values,d=m.touched,p=a.schema,f=(p=void 0===p?{}:p).fields,E=l.useMemo((function(){return Object.values(f||{}).reduce((function(e,n){return n.type===t.FormElementType.CHOICE?e[n.slug]=n.title:n.type!==t.FormElementType.PAGE&&n.type!==t.FormElementType.GROUP&&(e[n.id]=c[n.slug]),e}),{})}),[c]),h=(n=E,i=l.useRef(),l.useEffect((function(){i.current=n}),[n]),i.current);return l.useEffect((function(){o.actions&&o.actions.length>0&&o.actions.forEach&&o.actions.forEach((function(e){e.details.to.type===t.FormElementActionDetailsToType.FIELD&&(e.action===t.FormElementActionAction.HIDE&&u(e.details.to.value,{hidden:!!s(E,d,o,e.condition)}),e.action===t.FormElementActionAction.SHOW&&u(e.details.to.value,{hidden:!s(E,d,o,e.condition)}))}))}),[E,u,h,d]),null}));d.displayName="FormiumLogic";var p=i.memo((function(e){return i.createElement("input",Object.assign({},e,{type:"text",placeholder:"Type your answer here"}))})),f=i.memo((function(e){return i.createElement("textarea",Object.assign({},e,{rows:5,placeholder:"Type your answer here"}))})),E=i.memo((function(e){return i.createElement("div",null,i.createElement("input",{id:e.id,type:"checkbox",value:e.value,checked:e.checked,onChange:e.onChange,onBlur:e.onBlur,disabled:e.disabled}),i.createElement("label",{htmlFor:e.id},e.label))})),h=i.memo((function(e){return i.createElement("div",null,i.createElement("input",{id:e.id,type:"radio",value:e.value,checked:e.checked,onChange:e.onChange,onBlur:e.onBlur,disabled:e.disabled}),i.createElement("label",{htmlFor:e.id},e.label))})),y=function(e){return l.createElement("button",Object.assign({type:"button"},e))},g={SubmitButton:function(e){return l.createElement("button",Object.assign({type:"submit"},e))},NextButton:y,PreviousButton:y,Header:function(e){var t=e.page;return l.createElement(l.Fragment,null,t.title?l.createElement(0===e.pageIndex?"h1":"h2",null,t.title):null,t.description?l.createElement("p",null,t.description):null)},ElementsWrapper:function(e){return e.children},PageWrapper:function(e){return e.children},FooterWrapper:function(e){return e.children},FieldWrapper:function(e){return l.createElement("div",Object.assign({},e))},FormControl:l.memo((function(e){var t=e.children,n=e.description,r=e.error,i=e.label;return l.createElement("div",null,i&&l.createElement("label",{htmlFor:e.labelFor},i),n&&l.createElement("div",null,n),t,r&&l.createElement("div",null,r))})),TextInput:p,Textarea:f,Radio:h,Checkbox:E},b=function(e){return e.children};b.displayName="FormiumPage";var v=function(e){var n;return e&&(null===(n=e.schema)||void 0===n?void 0:n.fields)?Object.values(e.schema.fields).filter((function(e){return e.type!==t.FormElementType.GROUP&&e.type!==t.FormElementType.PAGE&&e.type!==t.FormElementType.CHOICE})):[]};function F(e){return a.object(e&&e.reduce((function(e,n){var r,l;return n.hidden||(n.type===t.FormElementType.CHECKBOX?r=a.array().of(a.string()):n.type===t.FormElementType.RADIO&&n.children&&n.children.length>0?(r=a.string(),n.allowOther||(r=r.oneOf(n.children.map((function(e){return e.title}))))):n.type===t.FormElementType.SHORT_TEXT||n.type===t.FormElementType.LONG_TEXT?(r=a.string(),n.maxLength&&(r=r.max(n.maxLength,"Must be less than "+n.maxLength))):n.type===t.FormElementType.EMAIL?(r=a.string().email("Invalid email"),n.maxLength&&(r=r.max(n.maxLength,"Must be less than "+n.maxLength+" characters"))):n.type===t.FormElementType.PHONE_NUMBER?(r=a.string(),n.maxLength&&(r=r.max(n.maxLength,"Must be less than "+n.maxLength+" characters"))):n.type===t.FormElementType.DATE?r=a.date():n.type===t.FormElementType.TIME?r=a.string():n.type===t.FormElementType.URL?(r=a.string().url("Invalid URL"),n.maxLength&&(r=r.max(n.maxLength,"Must be less than "+n.maxLength+" characters"))):n.type===t.FormElementType.BOOLEAN?r=a.boolean():n.type===t.FormElementType.NUMBER&&(r=a.number(),n.minValue&&(r=r.min(n.minValue,"Must be greater than "+n.minValue)),n.maxValue&&(r=r.max(n.maxValue,"Must be less than "+n.maxValue))),n.required&&(r=r.required(null!==(l=n.requiredText)&&void 0!==l?l:"This question requires an answer.")),e[n.slug]=r),e}),{}))}function x(e){return e.reduce((function(e,n){var r;return e[n.slug]=n.type===t.FormElementType.CHECKBOX?[]:null!==(r=n.defaultValue)&&void 0!==r?r:"",e}),{})}var T=l.memo((function(e){var t=e.component,n=e.name,i=m(e,["component","name"]),a=r.useFormikContext().getFieldMeta(n),o=a.error;return l.createElement(t,Object.assign({},i,{error:!!a.touched&&!!o&&o}))}));function O(e){var t=e.initialValues,i=e.children,a=e.onSubmit,o=e.components,s=void 0===o?g:o,d=e.debug,p=m(e,["initialValues","children","onSubmit","components","debug"]),f=p.data.id,E=l.useMemo((function(){return function(e){return"formium-"+e+"-form-page"}(f)}),[f]),h=l.useMemo((function(){return function(e){return"formium-"+e+"-form-state"}(f)}),[f]),y=function(e,t,r){if(!n.canUseDOM)return[0,function(){}];var i=JSON.stringify,a=JSON.parse,o=l.useState((function(){try{var t=sessionStorage.getItem(e);return null!==t?a(t):0}catch(e){return 0}})),u=o[0],m=o[1];return l.useEffect((function(){try{sessionStorage.setItem(e,i(u))}catch(e){}}),[u]),[u,m]}(E),b=y[0],v=y[1],F=l.useState(t||{}),x=F[0],T=F[1],O=l.useCallback((function(e){i&&(v((function(e){return Math.min(e+1,l.Children.toArray(i).length-1)})),T(e))}),[v,T,i]),C=l.useCallback((function(){v((function(e){return Math.max(e-1,0)}))}),[v]),S=l.useCallback((function(e){var t=l.Children.toArray(i)[b];return t.props.validationSchema?t.props.validationSchema:{}}),[i,b]),I=l.useCallback((function(e,t){try{return b===l.Children.count(i)-1?Promise.resolve(a(e).then((function(){sessionStorage.removeItem(E),sessionStorage.removeItem(h)}))):(t.setTouched({}),O(e),Promise.resolve())}catch(e){return Promise.reject(e)}}),[b,i,a,E,h,O]),k=l.Children.toArray(i)[b],L=b===l.Children.count(i)-1,q=r.useFormik(u({initialValues:x,onSubmit:I,validationSchema:S},p)),M=q.setFormikState,P=q.values,B=q.touched,N=q.initialValues;return l.useEffect((function(){n.canUseDOM()&&sessionStorage.setItem(h,JSON.stringify({values:P,touched:B,initialValues:N}))}),[P,B,q.errors,N,h]),c((function(){try{var e=sessionStorage.getItem(h);if(e){var t=JSON.parse(e);M(t)}}catch(e){}}),[M,h]),l.createElement(r.FormikContext.Provider,{value:q},l.createElement(r.Form,null,l.createElement(l.Fragment,null,l.createElement(s.PageWrapper,null,k,l.createElement(s.FooterWrapper,null,b>0&&l.createElement(s.PreviousButton,{type:"button",onClick:C},"Back"),!L&&l.createElement(s.NextButton,{type:"submit",disabled:q.isSubmitting},"Next"),L&&l.createElement(s.SubmitButton,{type:"submit",disabled:q.isSubmitting},"Submit"),d?l.createElement(l.Fragment,null,l.createElement("pre",{style:{marginTop:12,fontSize:11}},JSON.stringify(q,null,2)),l.createElement("pre",{style:{fontSize:11}},JSON.stringify({isLastPage:L},null,2))):null)))))}O.displayName="FormiumFormWizard",exports.FormiumForm=function(e){var n,i,a=e.data,o=e.components,c=void 0===o?g:o,s=m(e,["data","components"]),p=l.useState(a),f=p[0],E=p[1],h=function e(t,n){return t&&t.map((function(t){var r=n(t);return u({},r,r.items&&r.items.length>0?{children:e(r.items,n)}:{})}))}(null!==(n=null==f||null===(i=f.schema)||void 0===i?void 0:i.pageIds)&&void 0!==n?n:[],(function(e){var t;return null==f||null===(t=f.schema)||void 0===t?void 0:t.fields[e]})),y=x(v(f)),C=l.useCallback((function(e,t){E((function(n){var r,l,i,a,o,m;return u({},n,{schema:u({},null!==(r=n.schema)&&void 0!==r?r:{},{fields:u({},null!==(l=null===(i=n.schema)||void 0===i?void 0:i.fields)&&void 0!==l?l:{},(m={},m[e]=u({},null!==(a=null===(o=n.schema)||void 0===o?void 0:o.fields[e])&&void 0!==a?a:{},t),m))})})}))}),[E]);return l.createElement(O,Object.assign({components:c,initialValues:y,data:a},s),h&&h.map((function(e,n){return l.createElement(b,{key:e.id,validationSchema:F(h[n].children)},l.createElement(c.PageWrapper,null,l.createElement(c.Header,{form:f,page:e,pageIndex:n}),l.createElement(c.ElementsWrapper,null,e.children&&e.children.map((function(e,n){var i=e.id,a=e.children,o=e.hidden,u=e.required,s=e.placeholder,p=m(e,["id","children","actions","items","hidden","required","requiredText","defaultValue","placeholder"]);return o?null:l.createElement(c.FieldWrapper,{key:i},l.createElement(d,{form:f,element:e,setFieldProperty:C}),p.type===t.FormElementType.SHORT_TEXT?l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},l.createElement(r.Field,{as:c.TextInput,name:p.slug,placeholder:s,required:u,disabled:!1,id:i,type:"text"})):p.type===t.FormElementType.EMAIL?l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},l.createElement(r.Field,{as:c.TextInput,name:p.slug,placeholder:s,required:u,id:i,type:"email"})):p.type===t.FormElementType.URL?l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},l.createElement(r.Field,{as:c.TextInput,name:p.slug,placeholder:s,required:u,id:i,type:"url"})):p.type===t.FormElementType.RADIO?l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},c.RadioGroup?l.createElement(r.Field,{as:c.RadioGroup,id:i,name:p.slug,required:!!u,disabled:!1,options:a&&a.length>0&&a.map((function(e){return{id:e.id,disabled:!1,label:e.title,value:e.title}}))}):l.createElement(l.Fragment,null,a&&a.length>0&&a.map((function(e){return l.createElement("div",{key:e.id},l.createElement(r.Field,{as:c.Radio,value:e.title,label:e.title,type:"radio",name:p.slug,id:e.id}))})))):p.type===t.FormElementType.CHECKBOX?l.createElement(l.Fragment,null,l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},a&&a.length>0&&a.map((function(e){return l.createElement("div",{key:e.id},l.createElement(r.Field,{as:c.Checkbox,role:"checkbox",value:e.title,label:e.title,type:"checkbox",name:p.slug,id:e.id}))})))):p.type===t.FormElementType.LONG_TEXT?l.createElement(T,{required:!!u,label:p.title,labelFor:i,name:p.slug,description:p.description,component:c.FormControl,disabled:!1},l.createElement(r.Field,{as:c.Textarea,name:p.slug,placeholder:s,required:u,id:i})):null)})))))})))},exports.defaultComponents=g,exports.getChoiceMap=function(e){return Object.values(e).filter((function(e){return e.type===t.FormElementType.CHOICE})).reduce((function(e,t){return e[t.id]=t,e}),{}),{}},exports.getElementsFromForm=v,exports.getInitialValues=x,exports.getValidationSchema=F,exports.unstable_FormiumLogic=d;
//# sourceMappingURL=react.cjs.production.min.js.map
